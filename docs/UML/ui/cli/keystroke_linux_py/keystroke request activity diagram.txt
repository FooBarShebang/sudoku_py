@startuml

title Activity Diagram of the Keystroke Acquisition

start

fork

while (user input is required)
    if (there is data\nin the output buffer ?) then (True)
        :copy data\nfrom output\nbuffer;
        
        :clear output\nbuffer;
        
        :return data>
    endif
end while

fork again

    while (still running)
        if (input received ?) then (Yes)
            :append input to\nthe internal buffer;
            
            if (proper sequence\nis accumulated ?) then (True)
                if (output buffer\ndata is too old) then (Yes)
                    :clear output\nbuffer;
                    
                    :transfer data\ninto output\nbuffer;
                else (No)
                    :append data\nto the existing\nin the output\nbuffer;
                endif
            endif
        endif
    end while

fork again

    while (Stopper is not set)
        :check <b>stdin</b> ;
        
        if (data is available ?) then (Yes)
            :read 1 byte from <b>stdin</b> ;
            
            :send it to the buffer;
        endif
    end while

end fork

stop

@enduml